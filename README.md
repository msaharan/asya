# Asya

[![dh](./img/dh-logo.png)](#)

## Description

Asya is an async actor-based framework for serving AI workloads on Kubernetes. It provides a CRD-based operator pattern for deploying AI actors with automatic sidecar injection, message queue integration, and event-driven autoscaling.

ðŸ“š **[Full Documentation](docs/index.md)** | ðŸš€ **[Quick Start](docs/getting-started/quickstart.md)** | ðŸ“– **[Examples](examples/README.md)**

## Getting Started

### Option 1: Full OSS Stack (Recommended for Testing)

Complete deployment with RabbitMQ, Prometheus, Grafana, and example actors:

```bash
cd examples/deployment-minikube
./deploy.sh      # Automated deployment (~5-10 minutes)
./test-e2e.sh        # Verify deployment
```

See [examples/deployment-minikube/](./examples/deployment-minikube/) for details.

### Option 2: Minimal Framework Only

Install just the Asya operator and CRDs:

```bash
# 1. Install CRDs
kubectl apply -f operator/config/crd/

# 2. Install operator
helm install asya-operator deploy/helm-charts/asya-operator --create-namespace -n asya-system

# 3. Deploy an actor (requires existing queue)
kubectl apply -f examples/asyas/simple-actor.yaml
```

See [examples/deployment-minimal/](./examples/deployment-minimal/) for minimal framework deployment.

## Repository Structure

```
asya/
â”œâ”€â”€ src/                     # Framework components
â”‚   â”œâ”€â”€ asya-gateway/        # MCP gateway (Go)
â”‚   â”œâ”€â”€ asya-sidecar/        # Actor sidecar (Go)
â”‚   â”œâ”€â”€ asya-runtime/        # Actor runtime script (Python)
â”‚   â””â”€â”€ asya-otel-sidecar/   # OpenTelemetry sidecar (Python)
â”œâ”€â”€ operator/                # Kubernetes operator source
â”‚   â””â”€â”€ config/crd/          # AsyncActor CRD (generated by Kubebuilder)
â”œâ”€â”€ deploy/                  # Framework deployment
â”‚   â””â”€â”€ helm-charts/
â”‚       â”œâ”€â”€ asya-operator/   # Operator Helm chart
â”‚       â””â”€â”€ asya-gateway/    # Gateway Helm chart
â”œâ”€â”€ examples/                # Examples and reference deployments
â”‚   â”œâ”€â”€ asyas/               # Single AsyncActor CRD examples
â”‚   â”œâ”€â”€ deployment-minimal/  # Minimal framework deployment
â”‚   â””â”€â”€ deployment-minikube/ # Full OSS stack with automated tests
â””â”€â”€ scripts/                 # Build and deployment scripts
    â”œâ”€â”€ build-images.sh      # Build Docker images
    â”œâ”€â”€ load-images-minikube.sh  # Load images into Minikube
    â””â”€â”€ test-integration.sh  # Integration tests
```

## Architecture

See [Architecture Documentation](docs/architecture/overview.md) for detailed architecture information.

## Components

### Framework Components (`src/`)

- **asya-gateway**: MCP gateway implementing JSON-RPC 2.0 over HTTP
- **asya-sidecar**: Go sidecar for queue consumption (SQS/RabbitMQ)
- **asya-runtime**: Python base library for actor processing logic
- **asya-otel-sidecar**: OpenTelemetry sidecar for monitoring (planned)

### Kubernetes Operator (`operator/`)

CRD-based operator that:
- Watches AsyncActor resources
- Injects sidecar containers
- Manages Deployments/StatefulSets
- Configures KEDA autoscaling
- Sets up RBAC and secrets

## Testing

### Automated Deployment Tests

Test the complete framework deployment on Kubernetes:

```bash
# Run full deployment test suite
cd examples && ./run-all-tests.sh

# Or step-by-step
cd examples/deployment-minikube
./deploy.sh           # Deploy infrastructure
./test-e2e.sh             # Run verification tests
cd .. && ./test-actors.sh  # Test example actors
cd deployment-minikube && ./cleanup.sh  # Clean up
```

### Unit Tests

**All components**:
```bash
make test-unit
```

**Specific components**:
```bash
make test-unit-sidecar    # Go sidecar
make test-unit-gateway    # Go gateway
make test-unit-runtime    # Python runtime
```

**Manual (when needed)**:
```bash
# Go components
cd src/asya-sidecar && go test ./... -v

# Python components (requires uv)
cd src/asya-runtime && uv run pytest tests/ -v
```

### Integration Tests

**All integration tests**:
```bash
make test-integration
```

**Specific integration tests**:
```bash
make test-integration-sidecar   # E2E: Sidecar â†” Runtime via RabbitMQ
make test-integration-gateway   # E2E: Gateway â†” Actors via RabbitMQ
```

**Via script** (legacy):
```bash
./scripts/test-integration.sh
```

## Development

### Prerequisites

- Go 1.23+
- Python 3.13+
- **[uv](https://github.com/astral-sh/uv)** (required for Python development)
- Docker and Docker Compose
- Make

**Install uv**:
```bash
# macOS/Linux
curl -LsSf https://astral.sh/uv/install.sh | sh

# Windows
powershell -c "irm https://astral.sh/uv/install.ps1 | iex"
```

### Building

**Go Sidecar**:
```bash
cd src/asya-sidecar
make build
# or
go build -o bin/sidecar ./cmd/sidecar
```

**Docker Images**:
```bash
# Build all images
./scripts/build-images.sh

# Build and push to registry
./scripts/build-images.sh --push --registry docker.io/myuser --tag v1.0.0

# Load images into Minikube (for local development)
./scripts/load-images-minikube.sh --build

# Or load existing images
./scripts/load-images-minikube.sh --tag latest
```

### Accessing Grafana

Port-forward Grafana to view metrics and dashboards:

```bash
# Default port (3000)
./scripts/port-forward-grafana.sh

# Custom port
./scripts/port-forward-grafana.sh 8080
```

This will display admin credentials and open access to:
- Grafana UI at http://localhost:3000
- Pre-configured Prometheus data source (internal)
- Actor metrics dashboards

## Contributing

To contribute, please read our [contributing docs](CONTRIBUTING.md).

## License

Copyright Â© 2025 Delivery Hero SE

Contents of this repository are licensed under the Apache-2.0 [License](LICENSE).
