# Central Ruff configuration for all Python code in the Asya project
# Ruff replaces: flake8, isort, pyupgrade, autoflake, and more

# Target Python 3.12 (ruff-supported version)
target-version = "py312"
line-length = 120

[lint]
# Enable these rule sets:
# E/W - pycodestyle errors and warnings
# F - pyflakes
# I - isort (import sorting)
# N - pep8-naming
# UP - pyupgrade (modernize Python code)
# B - flake8-bugbear (likely bugs and design problems)
# A - flake8-builtins (shadowing built-ins)
# C4 - flake8-comprehensions (better list/dict/set comprehensions)
# SIM - flake8-simplify (simplification suggestions)
# RUF - Ruff-specific rules
select = ["E", "W", "F", "I", "N", "UP", "B", "A", "C4", "SIM", "RUF"]

# Ignore specific rules:
ignore = [
  "E501", # Line too long (handled by formatter)
]

# Allow autofix for all enabled rules
fixable = ["ALL"]
unfixable = []

# Exclude patterns
exclude = [
  ".git",
  ".venv",
  "venv",
  "__pycache__",
  "build",
  "dist",
  "*.egg-info",
]

[lint.per-file-ignores]
# Test files can have additional flexibility
"**/test_*.py" = [
  "S101",
  "SIM117",
] # Allow asserts in tests, nested with statements
"**/*_test.py" = ["S101", "SIM117"]
# asya-runtime supports Python 3.7+ for legacy AI model compatibility
"src/asya-runtime/**/*.py" = [
  "UP006",
  "UP007",
  "UP035",
  "UP038",
  "SIM105",
] # Allow typing.Dict/List for 3.7 compat, isinstance tuples, try-except-pass
# Operator embeds asya_runtime.py (copy of src/asya-runtime/asya_runtime.py)
"src/asya-operator/internal/controller/runtime_symlink/**/*.py" = [
  "UP006",
  "UP007",
  "UP035",
  "UP038",
  "SIM105",
] # Allow typing.Dict/List for 3.7 compat, isinstance tuples, try-except-pass
# end_handlers.py uses 'id' as variable name for envelope identifiers (common pattern in message handling)
"src/asya-crew/handlers/end_handlers.py" = [
  "A001",
  "A002",
  "SIM105",
  "UP017",
] # Allow shadowing id, contextlib.suppress, timezone.utc (datetime.UTC requires Python 3.11+)

[lint.isort]
# Configure import sorting to be compatible with black
force-single-line = false
force-sort-within-sections = false
lines-after-imports = 2
known-first-party = ["asya"]

[format]
# Use black-compatible formatting
quote-style = "double"
indent-style = "space"
skip-magic-trailing-comma = false
line-ending = "auto"
